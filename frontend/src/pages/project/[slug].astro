---
import Description from "@/components/astro/Description.astro";
import ShortDescription from "@/components/astro/ShortDescription.astro";
import Title from "@/components/astro/Title.astro";
import DateDisplay from "@/components/DateDisplay";
import EditAsAdmin from "@/components/EditAsAdmin";
import Links from "@/components/Links";
import Skills from "@/components/Skills";
import MainLayout from "@/layouts/main.astro";
import { fetchProjects } from "@/services/project";
import type { Seo } from "@/types/seo-type";
import { generateSlug } from "@/utils/utils";

export async function getStaticPaths() {
	const projects = await fetchProjects();

	return projects.map((project) => ({
		params: { slug: generateSlug(project.title) },
		props: { project },
	}));
}

const { slug } = Astro.params;
const { project } = Astro.props;

if (!project) {
	return Astro.redirect("/404");
}

const content: Seo = {
	title: project.title,
	description: `${project.short_description}`,
	image: `${project.image}`,
};
---

<MainLayout content={content}>
  <div class="space-y-6 max-w-2xl mx-auto">
    <EditAsAdmin href=`/admin/project/${project.id}` client:load />
    <img
      src={`${project.image}`}
      alt="profile image"
      class="w-full h-auto object-cover rounded-xl"
      style={{ aspectRatio: "16/9" }}
      onerror="this.onerror=null; this.src='/placeholder.png';"
    />
    <Title content={project.title} />
    <DateDisplay period={project} />
    <ShortDescription content={project.short_description} />
    {
      project.skills && (
        <Skills skillsString={project.skills} variant={"secondary"} />
      )
    }
    <Description content={project.description} />
    {project.links && <Links linksString={project.links} />}
  </div>
</MainLayout>
